---
const galleryItems = [
  {
    src: "https://res.cloudinary.com/dvjbrjvgf/image/upload/v1713085020/Aaccent/lo7ejjqsekqgxn6slyyd.jpg",
    alt: "Students in classroom",
    caption: "Interactive Learning Sessions",
    category: "Classes"
  },
  {
    src: "https://res.cloudinary.com/dvjbrjvgf/image/upload/v1713084512/Aaccent/holu1asphyeomjbpahmy.jpg",
    alt: "JEE preparation",
    caption: "JEE Advanced Coaching",
    category: "Achievement"
  },
  {
    src: "https://res.cloudinary.com/dvjbrjvgf/image/upload/v1705163557/Aaccent/y5yytlhy1ppa9pr7d3yq.jpg",
    alt: "Campus event",
    caption: "Collaborative Learning",
    category: "Events"
  },
  {
    src: "https://res.cloudinary.com/dvjbrjvgf/image/upload/v1713085112/Aaccent/o2kv5aveqpk7kekfabd1.jpg",
    alt: "Student studying",
    caption: "Focused Study Environment",
    category: "Classes"
  },
  {
    src: "https://res.cloudinary.com/dvjbrjvgf/image/upload/v1703397011/Aaccent/uxclyask1ylacycgqqcj.jpg",
    alt: "Board exam preparation",
    caption: "Board Exam Excellence",
    category: "Achievement"
  },
  {
    src: "https://res.cloudinary.com/dvjbrjvgf/image/upload/v1705152077/Aaccent/c8xldeivaha5c4qns3hf.jpg",
    alt: "Group activity",
    caption: "Saraswati Puja Celebration",
    category: "Events"
  }
];
---

<section class="gallery-section">
  <div class="gallery-container">
    <div class="section-header">
      <h2 class="section-title">Our Success Stories</h2>
      <p class="section-subtitle">
        Witness the journey of excellence at Advantage Academic Center
      </p>
    </div>

    <!-- Filter Buttons -->
    <div class="filter-buttons">
      <button class="filter-btn active" data-filter="all">All</button>
      <button class="filter-btn" data-filter="classes">Classes</button>
      <button class="filter-btn" data-filter="achievement">Achievements</button>
      <button class="filter-btn" data-filter="events">Events</button>
    </div>

    <!-- Gallery Grid -->
    <div class="gallery-grid">
      {galleryItems.map((item, index) => (
        <div 
          class="gallery-item" 
          data-category={item.category.toLowerCase()}
          data-index={index}
        >
          <div class="image-wrapper">
            <img src={item.src} alt={item.alt} loading="lazy" />
            <div class="overlay">
              <div class="overlay-content">
                <h3 class="image-caption">{item.caption}</h3>
                <span class="category-badge">{item.category}</span>
              </div>
              <button class="view-btn" data-image-index={index}>
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <path d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>
          </div>
        </div>
      ))}
    </div>
  </div>

  <!-- Lightbox Modal -->
  <div class="lightbox" id="lightbox">
    <button class="lightbox-close">
      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path d="M18 6L6 18M6 6l12 12" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </button>
    <button class="lightbox-prev">
      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path d="M15 18l-6-6 6-6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
    <button class="lightbox-next">
      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path d="M9 18l6-6-6-6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
    <div class="lightbox-content">
      <img src="" alt="" id="lightbox-image" />
      <div class="lightbox-info">
        <h3 id="lightbox-caption"></h3>
        <span id="lightbox-category"></span>
      </div>
    </div>
  </div>
</section>

<script>
  import gsap from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';

  gsap.registerPlugin(ScrollTrigger);

  // Gallery data
  const galleryData = [
    {
      src: "https://res.cloudinary.com/dvjbrjvgf/image/upload/v1713085020/Aaccent/lo7ejjqsekqgxn6slyyd.jpg",
      caption: "Interactive Learning Sessions",
      category: "Classes"
    },
    {
      src: "https://res.cloudinary.com/dvjbrjvgf/image/upload/v1713084512/Aaccent/holu1asphyeomjbpahmy.jpg",
      caption: "JEE Advanced Coaching",
      category: "Achievement"
    },
    {
      src: "https://res.cloudinary.com/dvjbrjvgf/image/upload/v1705152077/Aaccent/c8xldeivaha5c4qns3hf.jpg",
      caption: "Annual Day Celebration 2024",
      category: "Events"
    },
    {
      src: "https://res.cloudinary.com/dvjbrjvgf/image/upload/v1713085112/Aaccent/o2kv5aveqpk7kekfabd1.jpg",
      caption: "Focused Study Environment",
      category: "Classes"
    },
    {
      src: "https://res.cloudinary.com/dvjbrjvgf/image/upload/v1703397011/Aaccent/uxclyask1ylacycgqqcj.jpg",
      caption: "Board Exam Excellence",
      category: "Achievement"
    },
    {
      src: "https://res.cloudinary.com/dvjbrjvgf/image/upload/v1705163557/Aaccent/y5yytlhy1ppa9pr7d3yq.jpg",
      caption: "Collaborative Learning",
      category: "Events"
    }
  ];

  // Animate section header
  gsap.from('.section-header', {
    y: 30,
    duration: 0.8,
    ease: 'power2.out',
    scrollTrigger: {
      trigger: '.section-header',
      start: 'top 80%',
    }
  });

  // Animate gallery items
  const galleryItems = gsap.utils.toArray('.gallery-item');
  
  galleryItems.forEach((item: any) => {
    gsap.from(item, {
      opacity: 0,
      y: 50,
      duration: 0.6,
      ease: 'power2.out',
      scrollTrigger: {
        trigger: item,
        start: 'top 90%',
      }
    });
  });

  // Filter functionality
  const filterButtons = document.querySelectorAll('.filter-btn');
  const items = document.querySelectorAll('.gallery-item');

  filterButtons.forEach(button => {
    button.addEventListener('click', () => {
      const filter = button.getAttribute('data-filter');
      
      // Update active button
      filterButtons.forEach(btn => btn.classList.remove('active'));
      button.classList.add('active');

      // Filter items with animation
      items.forEach((item: any) => {
        const category = item.getAttribute('data-category');
        
        if (filter === 'all' || category === filter) {
          gsap.to(item, {
            opacity: 1,
            scale: 1,
            duration: 0.4,
            display: 'block'
          });
        } else {
          gsap.to(item, {
            opacity: 0,
            scale: 0.8,
            duration: 0.4,
            onComplete: () => {
              item.style.display = 'none';
            }
          });
        }
      });
    });
  });

  // Lightbox functionality
  const lightbox = document.getElementById('lightbox');
  const lightboxImage = document.getElementById('lightbox-image') as HTMLImageElement;
  const lightboxCaption = document.getElementById('lightbox-caption');
  const lightboxCategory = document.getElementById('lightbox-category');
  const closeBtn = document.querySelector('.lightbox-close');
  const prevBtn = document.querySelector('.lightbox-prev');
  const nextBtn = document.querySelector('.lightbox-next');

  let currentIndex = 0;

  function openLightbox(index: number) {
    currentIndex = index;
    updateLightboxContent();
    lightbox?.classList.add('active');
    document.body.style.overflow = 'hidden';
  }

  function closeLightbox() {
    lightbox?.classList.remove('active');
    document.body.style.overflow = 'auto';
  }

  function updateLightboxContent() {
    const item = galleryData[currentIndex];
    if (lightboxImage) lightboxImage.src = item.src;
    if (lightboxCaption) lightboxCaption.textContent = item.caption;
    if (lightboxCategory) lightboxCategory.textContent = item.category;
  }

  function showNext() {
    currentIndex = (currentIndex + 1) % galleryData.length;
    updateLightboxContent();
  }

  function showPrev() {
    currentIndex = (currentIndex - 1 + galleryData.length) % galleryData.length;
    updateLightboxContent();
  }

  // Event listeners
  document.querySelectorAll('.view-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      const index = parseInt(btn.getAttribute('data-image-index') || '0');
      openLightbox(index);
    });
  });

  closeBtn?.addEventListener('click', closeLightbox);
  nextBtn?.addEventListener('click', showNext);
  prevBtn?.addEventListener('click', showPrev);

  lightbox?.addEventListener('click', (e) => {
    if (e.target === lightbox) closeLightbox();
  });

  // Keyboard navigation
  document.addEventListener('keydown', (e) => {
    if (!lightbox?.classList.contains('active')) return;
    
    if (e.key === 'Escape') closeLightbox();
    if (e.key === 'ArrowRight') showNext();
    if (e.key === 'ArrowLeft') showPrev();
  });
</script>

<style>
  .gallery-section {
    padding: 3rem 2rem;
    background: linear-gradient(180deg, #fdf3f2 0%, #f5f5f4 100%);
  }

  .gallery-container {
    max-width: 1280px;
    margin: 0 auto;
  }

  .section-header {
    text-align: center;
    margin-bottom: 3rem;
  }

  .section-title {
    font-size: 2.5rem;
    font-weight: 800;
    color: #1a202c;
    margin-bottom: 1rem;
  }

  .section-subtitle {
    font-size: 1.125rem;
    color: #57534e;
    max-width: 600px;
    margin: 0 auto;
  }

  .filter-buttons {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
    margin-bottom: 3rem;
  }

  .filter-btn {
    padding: 0.75rem 1.5rem;
    background: white;
    border: 2px solid #e7e5e4;
    border-radius: 2rem;
    font-weight: 600;
    color: #57534e;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.875rem;
  }

  .filter-btn:hover {
    border-color: #1c1917;
    color: #1c1917;
  }

  .filter-btn.active {
    background: #1c1917;
    color: white;
    border-color: #1c1917;
  }

  .gallery-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
  }

  .gallery-item {
    position: relative;
    overflow: hidden;
    border-radius: 1rem;
    background: white;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    transition: transform 0.3s ease;
  }

  .image-wrapper {
    position: relative;
    overflow: hidden;
    aspect-ratio: 4/3;
  }

  .image-wrapper img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
  }

  .gallery-item:hover img {
    transform: scale(1.1);
  }

  .overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, transparent 60%);
    opacity: 0;
    transition: opacity 0.3s ease;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    padding: 1.5rem;
  }

  .gallery-item:hover .overlay {
    opacity: 1;
  }

  .overlay-content {
    transform: translateY(20px);
    transition: transform 0.3s ease;
  }

  .gallery-item:hover .overlay-content {
    transform: translateY(0);
  }

  .image-caption {
    font-size: 1.125rem;
    font-weight: 700;
    color: white;
    margin-bottom: 0.5rem;
  }

  .category-badge {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    background: rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(10px);
    border-radius: 1rem;
    font-size: 0.75rem;
    color: white;
    font-weight: 600;
  }

  .view-btn {
    position: absolute;
    top: 1rem;
    right: 1rem;
    width: 48px;
    height: 48px;
    background: rgba(255, 255, 255, 0.9);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transform: scale(0.8);
    transition: all 0.3s ease;
    color: #1c1917;
  }

  .gallery-item:hover .view-btn {
    opacity: 1;
    transform: scale(1);
  }

  .view-btn:hover {
    background: white;
    transform: scale(1.1);
  }

  /* Lightbox */
  .lightbox {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.95);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
  }

  .lightbox.active {
    opacity: 1;
    pointer-events: all;
  }

  .lightbox-content {
    max-width: 90vw;
    max-height: 90vh;
    position: relative;
  }

  .lightbox-content img {
    max-width: 100%;
    max-height: 80vh;
    object-fit: contain;
    border-radius: 0.5rem;
  }

  .lightbox-info {
    text-align: center;
    margin-top: 1.5rem;
  }

  .lightbox-info h3 {
    font-size: 1.5rem;
    color: white;
    margin-bottom: 0.5rem;
  }

  .lightbox-info span {
    display: inline-block;
    padding: 0.5rem 1rem;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 1rem;
    color: white;
    font-size: 0.875rem;
  }

  .lightbox-close,
  .lightbox-prev,
  .lightbox-next {
    position: absolute;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border: none;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    cursor: pointer;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
  }

  .lightbox-close {
    top: 2rem;
    right: 2rem;
  }

  .lightbox-prev {
    left: 2rem;
    top: 50%;
    transform: translateY(-50%);
  }

  .lightbox-next {
    right: 2rem;
    top: 50%;
    transform: translateY(-50%);
  }

  .lightbox-close:hover,
  .lightbox-prev:hover,
  .lightbox-next:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-50%) scale(1.1);
  }

  .lightbox-close:hover {
    transform: scale(1.1);
  }

  @media (max-width: 768px) {
    .section-title {
      font-size: 2rem;
    }

    .gallery-grid {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }

    .lightbox-prev,
    .lightbox-next {
      width: 40px;
      height: 40px;
    }

    .lightbox-prev {
      left: 1rem;
    }

    .lightbox-next {
      right: 1rem;
    }
  }
</style>